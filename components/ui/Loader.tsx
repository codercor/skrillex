"use client";

import React, { useRef } from "react";
import { useGSAP } from "@gsap/react";
import gsap from "gsap";

const Loader = () => {
    const containerRef = useRef<HTMLDivElement>(null);
    const svgRef = useRef<SVGSVGElement>(null);

    useGSAP(() => {
        const tl = gsap.timeline();

        const paths = svgRef.current?.querySelectorAll("path");

        if (paths) {
            tl.fromTo(
                paths,
                {
                    strokeDasharray: 1000,
                    strokeDashoffset: 1000,
                    opacity: 1,
                    fillOpacity: 0,
                },
                {
                    strokeDashoffset: 0,
                    duration: 2,
                    ease: "power2.inOut",
                    stagger: 0.05,
                }
            )
            if (containerRef.current) {
                tl.to(containerRef.current.querySelectorAll("path"), {
                    fillOpacity: 1,
                    duration: 1,
                    ease: "power2.out"
                }, "-=0.5")
                    .to(containerRef.current, {
                        opacity: 0,
                        duration: 0.5,
                        ease: "power2.inOut",
                        onComplete: () => {
                            if (containerRef.current) {
                                containerRef.current.style.display = "none";
                            }
                        }
                    }, "+=0.3");
            }
        }
    }, { scope: containerRef });

    return (
        <div
            ref={containerRef}
            className="fixed inset-0 z-9999 flex items-center justify-center bg-background"
        >
            <svg
                ref={svgRef}
                width="230"
                height="174"
                viewBox="0 0 230 174"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                className="w-48 h-auto md:w-64" // Responsive sizing
            >
                <path d="M4.50043 45.5001L4.50043 99.5001" stroke="#6B5DD3" strokeWidth="8" />
                <path d="M41.0004 4.00009C40.0004 24.5001 28.0004 45.5 4.00042 48.5001" stroke="#6B5DD3" strokeWidth="8" strokeLinecap="round" />
                <path d="M40.5004 4.50006L40.5004 99.5001" stroke="#6B5DD3" strokeWidth="8" strokeLinecap="round" />
                <path d="M40.5005 4.49995C60.0004 40.5 92.0004 29.5 104.5 37.4999" stroke="#6B5DD3" strokeWidth="8" strokeLinecap="round" />
                <path d="M109.5 42.5001C79.0004 49.0001 60.5004 71.0001 56.5004 103.5" stroke="#6B5DD3" strokeWidth="8" strokeLinecap="round" />
                <path d="M0.500427 103.5H60.5004" stroke="#6B5DD3" strokeWidth="8" />
                <path d="M225.5 45.7707V99.7707" stroke="#6B5DD3" strokeWidth="8" />
                <path d="M189 4.27072C190 24.7707 202 45.7707 226 48.7707" stroke="#6B5DD3" strokeWidth="8" strokeLinecap="round" />
                <path d="M189.5 4.77069V99.7707" stroke="#6B5DD3" strokeWidth="8" strokeLinecap="round" />
                <path d="M189.5 4.77058C170 40.7707 138 29.7707 125.5 37.7706" stroke="#6B5DD3" strokeWidth="8" strokeLinecap="round" />
                <path d="M120.5 42.7707C151 49.2707 169.5 71.2707 173.5 103.771" stroke="#6B5DD3" strokeWidth="8" strokeLinecap="round" />
                <path d="M229.5 103.771H169.5" stroke="#6B5DD3" strokeWidth="8" />
                <path d="M89.6342 30.0616L139.105 30.4571C139.659 30.4616 139.795 31.23 139.277 31.4249L128.91 35.3126C128.373 35.514 127.998 36.0037 127.944 36.5743L127.089 45.5479C127.065 45.8043 126.849 46 126.591 46.0001H103.457C103.19 45.9998 102.97 45.7888 102.958 45.5215L102.532 35.7061C102.503 35.0557 102.059 34.498 101.431 34.3253L89.4975 31.043C88.9336 30.8878 89.0492 30.0569 89.6342 30.0616Z" fill="#6B5DD3" stroke="#6B5DD3" className="icon-center" />
                <path d="M6.87831 158.229V122.529H21.5153C23.9973 122.529 26.0883 122.92 27.7883 123.702C29.4883 124.484 30.7633 125.572 31.6133 126.966C32.4973 128.326 32.9393 129.907 32.9393 131.709C32.9393 133.511 32.5483 135.024 31.7663 136.248C30.9843 137.472 29.9473 138.424 28.6553 139.104C27.3973 139.75 26.0033 140.124 24.4733 140.226L25.2893 139.665C26.9213 139.733 28.3663 140.175 29.6243 140.991C30.9163 141.773 31.9193 142.827 32.6333 144.153C33.3813 145.479 33.7553 146.924 33.7553 148.488C33.7553 150.392 33.2963 152.075 32.3783 153.537C31.4603 154.999 30.1343 156.155 28.4003 157.005C26.6663 157.821 24.5413 158.229 22.0253 158.229H6.87831ZM13.7633 152.619H20.9033C22.7733 152.619 24.2183 152.194 25.2383 151.344C26.2583 150.494 26.7683 149.27 26.7683 147.672C26.7683 146.074 26.2413 144.833 25.1873 143.949C24.1333 143.031 22.6713 142.572 20.8013 142.572H13.7633V152.619ZM13.7633 137.421H20.3933C22.1953 137.421 23.5553 137.013 24.4733 136.197C25.4253 135.381 25.9013 134.225 25.9013 132.729C25.9013 131.267 25.4253 130.128 24.4733 129.312C23.5553 128.462 22.1783 128.037 20.3423 128.037H13.7633V137.421ZM36.7548 158.229L49.8108 122.529H57.6138L70.6188 158.229H63.3258L53.6868 130.383L43.9968 158.229H36.7548ZM42.5178 150.12L44.3538 144.765H62.5098L64.2948 150.12H42.5178ZM87.601 158.841C85.017 158.841 82.705 158.399 80.665 157.515C78.659 156.631 77.061 155.339 75.871 153.639C74.715 151.939 74.12 149.882 74.086 147.468H81.379C81.413 148.522 81.685 149.474 82.195 150.324C82.705 151.174 83.402 151.854 84.286 152.364C85.204 152.84 86.292 153.078 87.55 153.078C88.638 153.078 89.573 152.908 90.355 152.568C91.171 152.194 91.8 151.684 92.242 151.038C92.684 150.392 92.905 149.627 92.905 148.743C92.905 147.723 92.65 146.873 92.14 146.193C91.664 145.513 90.984 144.935 90.1 144.459C89.25 143.983 88.247 143.558 87.091 143.184C85.969 142.776 84.779 142.351 83.521 141.909C80.699 140.991 78.54 139.767 77.044 138.237C75.582 136.707 74.851 134.684 74.851 132.168C74.851 130.026 75.361 128.19 76.381 126.66C77.435 125.13 78.88 123.957 80.716 123.141C82.552 122.325 84.643 121.917 86.989 121.917C89.403 121.917 91.511 122.342 93.313 123.192C95.149 124.008 96.594 125.198 97.648 126.762C98.736 128.326 99.297 130.162 99.331 132.27H91.987C91.953 131.488 91.715 130.757 91.273 130.077C90.865 129.363 90.287 128.802 89.539 128.394C88.791 127.952 87.907 127.731 86.887 127.731C86.003 127.697 85.187 127.833 84.439 128.139C83.725 128.445 83.147 128.904 82.705 129.516C82.297 130.094 82.093 130.825 82.093 131.709C82.093 132.559 82.297 133.273 82.705 133.851C83.147 134.429 83.742 134.939 84.49 135.381C85.238 135.789 86.122 136.18 87.142 136.554C88.162 136.894 89.267 137.251 90.457 137.625C92.225 138.237 93.857 138.968 95.353 139.818C96.849 140.634 98.039 141.705 98.923 143.031C99.807 144.357 100.249 146.108 100.249 148.284C100.249 150.154 99.756 151.888 98.77 153.486C97.784 155.084 96.356 156.376 94.486 157.362C92.65 158.348 90.355 158.841 87.601 158.841ZM106.089 158.229V122.529H129.549V128.088H112.974V137.421H128.019V142.776H112.974V152.67H129.549V158.229H106.089ZM135.823 158.229V122.529H142.708V152.874H158.365V158.229H135.823ZM164.261 158.229V122.529H187.721V128.088H171.146V137.421H186.191V142.776H171.146V152.67H187.721V158.229H164.261ZM192.159 158.229L203.43 140.124L192.006 122.529H199.962L207.816 134.718L215.007 122.529H222.759L211.59 140.43L223.065 158.229H215.109L207.204 145.836L199.962 158.229H192.159Z" fill="#6B5DD3" stroke="#6B5DD3" strokeWidth="1.5" className="text-path" />
            </svg>
        </div>
    );
};

export default Loader;
